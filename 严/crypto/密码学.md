# 密码学

> 完整提纲见
> [幕布-密码学](https://mubu.com/doc/eGuO1axZv)

---

# 目的

- 信息安全CIA三要素
    - 机密性（Confidentiality）
    - 完整性（Integrity）
    - 可用性（Availability）
- 认证性（Authentication）
- 不可否认性（Non-repudiation）

# 攻击类型

- 唯密文攻击
- 已知明文攻击
- 选择明文攻击
- 选择密文攻击

# 分类

- 古典密码学
    - 种类
        - 单表代换加密

          - 通用特点
            - 在密钥空间较小的情况下，采用暴力破解方式
            - 在密文长度足够长的时候，使用词频分析
          - 种类
            - 凯撒密码
              - 原理
                - 将明文中的 每个字母 都按照其在字母表中的顺序
                - 向后（或向前）移动固定数目（循环移动）作为密文
              - 变种：Keyed Caesar
                - 原理
                  - 利用一个密钥，将密钥的每一位转换为数字（一般转化为字母表对应顺序的数字）
                  - 分别以这一数字为密钥加密明文的每一位字母
              - 破解
                - 遍历 26 个偏移量，适用于普遍情况,肯定能得到明文
                - 利用词频分析，适用于密文较长的情况,不一定能得到明文
            - 移位密码
              - 原理
                - 与凯撒密码类似
                - 不仅会处理字母，还会处理数字和特殊字符
                - 常用 ASCII 码表进行移位
            - 埃特巴什码（Atbash Cipher）
              - 原理
                - 使用字母表中的最后一个字母代表第一个字母
                - 倒数第二个字母代表第二个字母
              - 破解
                - 密钥空间小，可爆破
                - 密文长时可用词频
            - 简单替换密码（Simple Substitution Cipher）
              - 原理
                - 将每个明文字母替换为与之唯一对应且不同的字母
              - 破解
                - 几乎不能暴力枚举
                - 采用词频分析
            - 仿射密码
              - 原理
                - 加密函数是 E(x)=(ax+b)(mod m)
                  - x 表示明文按照某种编码得到的数字
                  - a、m互质
                  - m 是编码系统中字母的数目
              - 破解
                - 解密函数是 D(x)=a^(-1)(x−b)(mod m)
                  - 需得知部分明文
                - 词频法

        - 多表代换加密

          - 特点

            - 加密后的字母几乎不再保持原来的频率
            - 一般只能通过寻找算法实现对应的弱点进行破解

          - 种类

            - Playfair

              - 原理
                - 选取一串英文字母，除去重复出现的字母，将剩下的字母逐个逐个加入 5 × 5 的矩阵内，剩下的空间由未加入的英文字母依 a-z 的顺序加入。注意，将 q 去除，或将 i 和 j 视作同一字
                - 将要加密的明文分成两个一组。若组内的字母相同，将 X（或 Q）加到该组的第一个字母后，重新分组。若剩下一个字，也加入 X
                - 在每组中，找出两个字母在矩阵中的地方
                  - 若两个字母不同行也不同列，在矩阵中找出另外两个字母（第一个字母对应行优先），使这四个字母成为一个长方形的四个角
                  - 若两个字母同行，取这两个字母右方的字母（若字母在最右方则取最左方的字母）
                  - 若两个字母同列，取这两个字母下方的字母（若字母在最下方则取最上方的字母）

            - 棋盘密码（Polybius）

              - 原理

                - 12345密码表

                  ![img](https://img.mubu.com/document_image/tos_cca20067-7e9b-4f94-9bcc-f06d461537c2-46591.jpg)

                - ADFGX密码表

                  ![img](https://img.mubu.com/document_image/tos_bcfff76c-0788-4abf-bd4d-8af172fc6753-46591.jpg)

            - 维吉尼亚密码（Vigenere）

              - 原理
                - 使用一系列凯撒密码组成密码字母表
                - 对密钥进行填充使其长度与明文长度一样
                - 查表得密文
              - 破解
                - 关键在于密钥是循环重复的
                - 密钥长度
                  - 卡西斯基试验
                  - 弗里德曼试验

            - 关键字密码（Nihilist）

              - 原理
                - 首先利用密钥构造棋盘矩阵
                - 新建一个 5 × 5 矩阵，将字符不重复地依次填入矩阵
                - 剩下部分按字母顺序填入，字母 i 和 j 等价
              - 密文特点
                - 纯数字
                - 只包含 1 到 5
                - 密文长度偶数

            - 希尔密码（Hill）

              - 原理
                - 使用每个字母在字母表中的顺序作为其对应的数字
                - 然后将明文转化为 n 维向量，跟一个 n × n 的矩阵相乘
                - 再将得出的结果模 26

            - 自动密钥密码（Autokey Cipher）

              - 原理
                - 与维吉尼亚密码密码类似
                - 关键词自动密钥或原文自动密钥

        - 其他

          - 培根密码

            - 原理

              - 使用两种不同的字体，代表 A 和 B

              - 结合加密表进行加解密

                ![img](https://img.mubu.com/document_image/tos_49eae321-c99b-487d-9c31-620a64905792-46591.jpg)

            - 特点

              - 只有两种字符
              - 每一段的长度为 5
              - 加密内容会有特殊的字体之分，亦或者大小写之分

          - 栅栏密码

            - 原理
              - 把要加密的明文分成 N 个一组
              - 然后把每组的第 1 个字连起来

          - 曲路密码（Curve Cipher）

            - 原理
              - 是一种换位密码
              - 需要事先双方约定密钥（也就是曲路路径）

          - 列移位密码（Columnar Transposition Cipher）

            - 原理
              - 易于实现的换位密码
              - 明文填入表
              - 通过简单的规则打乱列
              - 把每列取出💺密文

          - 01248密码（云影密码）

            - 原理
              - 使用 0，1，2，4，8 四个数字
              - 其中 0 用来表示间隔
              - 其他数字以加法可以表示出字母

          - JSFuck

            - 只用 6 个字符 []()!+ 来编写 JavaScript 程序

          - BrainFuck

          - 猪圈密码

            ![img](https://img.mubu.com/document_image/tos_89bb8ec0-e971-4864-bda6-7d3b13a77efd-46591.jpg)

          - 舞动的小人密码

          - 键盘密码

            - 手机键盘密码

              - 用两位数字表示字母法
              - 拼音法

            - 电脑键盘棋盘

              ![img](https://img.mubu.com/document_image/tos_5604569b-9d87-4a32-bf17-bf30fa010013-46591.jpg)

            - 电脑键盘坐标

              ![img](https://img.mubu.com/document_image/tos_f8232810-3d46-46dd-acce-9bcafba6f6ef-46591.jpg)

            - 电脑键盘QWE

              ![img](https://img.mubu.com/document_image/tos_541a79f2-fe02-4b9c-bfb9-21d4c75ad791-46591.jpg)

            - 电脑布局加密
    - 破解思路
        - 已知密码，识别密码
            - 加密方式判别
            - 字符集判别
            - 加密结果样子判别
        - 未知密码，分析密码特性，利用暴力破解或者相应思路求解

- 现代密码学

    - 对称加密

      - 方式

        - 分组密码（块密码）

          - 常见算法

            - IDEA

               

              国际数据加密算法（International Data Encryption Algorithm，IDEA）
              最早称为改良建议加密标准（Improved Proposed Encryption Standard，IPES）

              - 基本流程
                - 密钥生成
                  - 每轮中使用 6个密钥，然后最后输出轮使用4个密钥，所以一共有52个
                    - 前8个密钥来自与该算法最初的密钥，K1 取自密钥的高16比特，K8 取自密钥的低16比特
                    - 将密钥循环左移 25 位获取下一轮密钥，然后再次分为8组
                - 加密
                  - 该算法会对输入的数据块进行8次相同的变换，只是每次使用的密钥不同
                  - 每一轮运算
                    - 按位异或
                    - 模加
                    - 模乘
                - 解密
                  - 第 i(1-9) 轮的解密的密钥的前 4 个子密钥由加密过程中第10-i 轮的前 4 个子密钥得出
                  - 其中第 1 个和第 4 个解密子密钥为相应的子密钥关于 216+1216+1 的乘法逆元。
                  - 第 2 个和第 3 个子密钥的取法为
                    - 当轮数为2，...，8时，取相应的第3个和第2个的子密钥的216216 的加密逆元。
                    - 当轮数为 1 或 9 时，取相应的第 2 个和第 3 个子密钥对应的216216 的加密逆元。
                  - 第 5 和第 6 个密钥不变

            - DES

               

              Data Encryption Standard

              - 特点

                - 输入 64 位
                - 输出 64 位
                - 密钥 64 位，使用 64 位密钥中的 56 位，剩余的 8 位要么丢弃，要么作为奇偶校验位
                - Feistel 迭代结构
                  - 明文经过 16 轮迭代得到密文
                  - 密文经过类似的 16 轮迭代得到明文

              - 基本流程

                ![img](https://img.mubu.com/document_image/tos_59576356-7755-4f84-87fd-c2875f1dbc56-46591.jpg)

                - 核心部件
                  - 初始置换
                  - F 函数
                    - E 扩展函数
                    - S 盒，设计标准未给出。
                    - P 置换
                  - 最后置换

              - 衍生

                - 双重 DES
                - 三重 DES

              - 攻击方法

                - 差分攻击
                - 线性攻击

            - AES

               

              Advanced Encryption Standard（AES），高级加密标准

              - 特点
                - 输入：128 比特。
                - 输出：128 比特。
                - SPN 网络结构。
              - 基本流程
                - 轮密钥加，AddRoundKey
                - 字节替换，SubBytes
                - 行移位，ShiftRows
                - 列混淆，MixColumns
              - 等价算法
                - 交换逆向行移位和逆向字节代替并不影响结果。
                - 交换轮密钥加和逆向列混淆并不影响结果，关键在于
                - 首先可以把异或看成域上的多项式加法
                - 然后多项式中乘法对加法具有分配率
              - 攻击方法
                - 积分攻击

            - Simon 块加密算法（Simon Block Cipher）

              - 在硬件实现上进行了优化
              - 是平衡的 Feistel cipher 加密

          - 基本策略

            - 混淆
              - 将密文与密钥之间的统计关系变得尽可能复杂
              - 方法
                - S盒
                - 乘法
            - 扩散
              - 使得明文中的每一位影响密文中的许多位
              - 方法
                - 线性变换
                - 置换
                - 移位，循环移位

          - 加密结构

            - 迭代结构
              - 组成
                - 密钥置换
                - 轮加密函数
                - 轮解密函数
              - 轮函数设计方法
                - Feistel Network
                  for DES
                - Substitution-Permutation Network(SPN)
                  for AES
                - 其他

          - ARX运算

            - 包括
              - Add 有限域上的模加
              - Rotate 循环移位
              - Xor 异或
            - 优点
              - 操作简单，运算速度快
              - 执行时间为常数，可以避免基于时间的侧信道攻击
              - 组合后的函数表达能力足够强
            - 缺点
              - Rotate、Xor 对于单个 bit 来说均是完全线性的运算，可能会带来一定的脆弱性

          - 分组模式

            - 填充规则
              - Pad with bytes all of the same value as the number of padding bytes (PKCS5 padding)
              - Pad with 0x80 followed by zero bytes (OneAndZeroes Padding)
              - Pad with zeroes except make the last byte equal to the number of padding bytes
              - Pad with zero (null) characters
              - Pad with spaces
              - 电子密码本模式（Electronic codebook，ECB）
                - 优点
                  - 实现简单
                  - 不同明文分组的加密可以并行计算，速度很快
                - 缺点
                  - 同样的明文块会被加密成相同的密文块，不会隐藏明文分组的统计规律
                - 应用
                  - 用于随机数的加密保护。
                  - 用于单分组明文的加密。

        - 序列密码（流密码）

          - 特点

            - 流密码的密钥长度会与明文的长度相同
            - 流密码的密钥派生自一个较短的密钥，派生算法通常为一个伪随机数生成算法
            - 伪随机数生成算法生成的序列的随机性越强，明文中的统计特征被覆盖的更好
            - 流密码的关键在于设计好的伪随机数生成器

          - 伪随机数生成器

             

            （pseudorandom number generator，PRNG）
            又称为确定性随机位生成器（deterministic random bit generator，DRBG）

            - 随机的性质

              ![img](https://img.mubu.com/document_image/tos_69eb0997-1dc3-4729-93f1-4290dd0e6277-46591.jpg)

              - 随机性：随机数应该不存在统计学偏差，是完全杂乱的数列
              - 不可预测性：不能从过去的序列推测出下一个出现的数
              - 不可重现性：除非数列保存下来，否则不能重现相同的数列

            - 周期

              - 对于一个 PRNG 的所有可能起始状态，不重复序列的最长长度

            - 分类

              - 线性同余生成器，LCG
              - 线性回归发生器
              - Mersenne Twister
              - xorshift generators
              - WELL family of generators
              - 反馈移位寄存器
                - 线性反馈移位寄存器（LFSR）
                - 非线性反馈移位寄存器（NFSR）

            - 缺点

              - 在某些种子的情况下，其生成的随机数序列的周期会比较小
              - 生成大数时，分配的不均匀
              - 连续值之间关联密切，知道后续值，可以知道之前的值
              - 输出序列的值的大小很不均匀

            - 密码学安全伪随机数生成器

               

              cryptographically secure pseudo-random number generator，CSPRNG
              也称为密码学伪随机数生成器（cryptographic pseudo-random number generator，CPRNG)

              - 应用
                - 密钥生成
                - 生成初始化向量，IV，用于分组密码的 CBC，CFB，OFB 模式
                - nounce，用于防止重放攻击以及分组密码的 CTR 模式等、
                - one-time pads
                - 某些签名方案中的盐，如 ECDSA， RSASSA-PSS
              - 要求
                - 通过统计随机性测试（next-bit test）
                - 必须能够抵抗足够强的攻击
              - 设计分类
                - 基于密码学算法，如密文或者哈希值
                - 基于数学难题
                - 某些特殊目的的设计

          - RC4

            - 应用
              - SSL/TLS 协议
              - WEP/WPA 协议
            - 基本流程
              - 初始化 S 和 T 数组
              - 初始化置换 S
              - 生成密钥流

    - 非对称加密

      - 特点
        - 加密者与解密者所使用的密钥并不一样
      - 种类
        - RSA
          - 来源
            - 罗纳德·李维斯特（Ron Rivest）
            - 阿迪·萨莫尔（Adi Shamir）
            - 伦纳德·阿德曼（Leonard Adleman）
          - 可靠性基础
            - 由极大整数因数分解的难度决定
          - 原理
            - 公钥与私钥的产生算法
            - 消息加密
            - 消息解密
          - 攻击
            - 模数相关攻击
              - 暴力分解N
                - 条件
                  - 在 N 的比特位数小于 512 的时候，可以采用大整数分解的策略获取 p 和 q
              - p & q 不当分解 N
                - 条件
                  - 当 RSA 中 p 和 q 选取不当时
                - 分类
                  - |p-q| 很大
                    - 通过穷举的方法对模数进行试除
                    - 基本来说，不怎么可行
                  - |p-q| 较小
                    - 顺序检查 √n 的每一个整数 x，直到找到一个 x 使得 x^2−nx是平方数，记为 y^2
                    - 那么 x2−n=y2，进而根据平方差公式即可分解 N
                  - p - 1 光滑
                    - 可能可以使用 Pollard's p − 1 算法来分解 N
                  - p + 1 光滑
                    - 可能可以使用 Williams's p + 1 算法来分解 N
              - 模不互素
                - 攻击原理
                  - 当存在两个公钥的 N 不互素时，我们显然可以直接对这两个数求最大公因数
                  - 然后直接获得 p，q，进而获得相应的私钥
              - 共模攻击
                - 条件
                  - 当两个用户使用相同的模数 N、不同的私钥时
                - 攻击原理
                  - 设两个用户的公钥分别为 e1e1 和 e2e2，且两者互质，明文消息为m，则可得出密文c1,c2
                  - 当攻击者截获 c1c1 和 c2c2 后，就可以恢复出明文
            - 公钥指数相关攻击
              - 小公钥指数攻击
                - 条件
                  - e特别小
                - 攻击原理
                  - 从小到大枚举 kk，依次开e次根，直到开出整数为止
              - Rabin算法
                - 条件
                  - Rabin算法的e=2
            - 私钥 d 相关攻击
              - d 泄露攻击
                - 攻击原理
                  - 当 d 泄露之后，可以解密所有加密的消息
                  - 还可以对模数 N 进行分解
              - Wiener's Attack
                - 条件
                  - d比较小
            - Coppersmith 相关攻击
              - 原理
                - 通过 Lenstra–Lenstra–Lovász lattice basis reduction algorithm（LLL）方法
              - Basic Broadcast Attack
                - 条件
                  - 如果一个用户使用同一个加密指数 e 加密了同一个密文
                  - 并发送给了其他 e 个用户
                - 原理
                  - 根据中国剩余定理
              - Broadcast Attack with Linear Padding
              - Related Message Attack
                - 条件
                  - 使用同一公钥对两个具有某种线性关系的消息 M1 与 M2 进行加密
                - 攻击原理
              - Coppersmith’s short-pad attack
                - 条件
                  - padding 的长度过短
                  - 即对应的多项式的根会过小
                - 攻击原理
              - Known High Bits Message Attack
                - 条件
                  - 知道消息 m 的很大的一部分 m0，即 m=m0+x，但是我们不知道 x
              - Factoring with High Bits Known
                - 条件
                  - 知道一个公钥中模数 N 的一个因子的较高位时
              - Boneh and Durfee attack
                - 条件
                  - 当 d 较小时
                - 攻击原理
            - RSA选择密文攻击
              - 任意密文解密
              - RSA parity oracle
            - RSA侧信道攻击（能量分析攻击）
              - 分类
                - 简单能量分析攻击（SPA）
                - 差分能量分析攻击（DPA）
              - 条件
                - 攻击者可获取与加解密相关的侧信道信息
                - 例如能量消耗、运算时间、电磁辐射等等
            - Bleichenbacher's attack
        - 背包加密
          - 背包问题
          - Merkle–Hellman
            - 原理
              - 公钥生成
              - 私钥生成
              - 加密
              - 解密
            - 破解
              - 只需找出任意模数 m′ 和乘数 w′
              - 只要使用 w′ 去乘公开的背包向量 B 时，能够产生超递增的背包向量即可
        - ElGamal
          - 概述
            - 基于求解离散对数问题的困难性
            - 双钥密码体制
            - 既可以用于加密又可用于数字签名
          - 基本原理
            - 密钥生成
            - 加密
            - 解密
        - 椭圆曲线加密（ECC）
          - 概述
            - 基于椭圆曲线数学的公钥密码
            - 依赖于解决椭圆曲线离散对数问题的困难性
          - 基本原理
            - 密钥生成
            - 加密
            - 解密
        - 格密码
      - 离散对数
        - 基本概念
          - 生成元
          - 阶
          - 原根
        - 基本性质
          - 对于素数 p 来说，每一个与其互素的数都是它的原根
          - 使得 a^d≡1(mod m) 成立的最小正整数 d ，必有d|φ(m)
          - 模 m 存在原根的必要条件是 m=1,2,4,p^α,2p^α
        - 离散对数问题
          - 如果 y=g^x mod p
          - 那么已知 g，p，y，我们很难求得 x
        - 求解方式
          - 暴力破解
          - Baby-step giant-step（小步大步法）
          - Pollard’s ρ algorithm
          - Pollard’s kangaroo algorithm
          - The Pohlig-Hellman algorithm

    - 哈希函数

      - 概述
        - 基本需求
          - 输入长度可变
          - 输出长度固定
          - 效率高
          - 单向性
          - 抗弱碰撞性
          - 抗强碰撞性
          - 哈希函数的输出满足伪随机性测试标准
        - 目的
          - 确保消息的完整性，即确保收到的数据确实和发送时的一样（即没有修改、插入、删除或重放），防止中间人篡改。
          - 冗余校验
          - 单向口令文件，比如linux系统的密码
          - 入侵检测和病毒检测中的特征码检测
      - 种类
        - MD5
          - 输入
            - 任意长的消息
            - 512比特长的分组
          - 输出
            - 128比特的消息摘要
          - 初始化IV
            - 0x67452301
            - 0xEFCDAB89
            - 0x98BADCFE
            - 0x10325476
        - SHA-1
          - 输入
            - 任意长的消息，分为 512 比特长的分组
            - 首先在消息右侧补比特 1，然后再补若干个比特 0，直到消息的比特长度满足对 512 取模后余数是 448，使其与 448 模 512 同余
          - 输出
            - 160 比特的消息摘要
          - 初始化IV
            - 0x67452301
            - 0xEFCDAB89
            - 0x98BADCFE
            - 0x10325476
            - 0xC3D2E1F0
        - SHA-512
        - Fowler–Noll–Vo hash function
      - 攻击
        - 主要方法
          - 暴力攻击
            - 不依赖于任何算法细节
            - 仅与Hash值长度有关
          - 生日攻击法(Birthday Attack)
            - 没有利用Hash函数的结构和任何代数弱性质
            - 只依赖于消息摘要的长度，即Hash值的长度
          - 中点交会攻击法(Meet-In-The-Middle)
            - 是生日攻击的一种变形，不比较Hash值，而是比较中间变量
            - 这种攻击主要适用于攻击具有分组链结构的Hash方案
          - 密码分析
            - 依赖于具体算法的设计缺点
          - 哈希长度拓展攻击（hash length extension attacks）
            - 概述
              - 针对某些允许包含额外信息的加密散列函数的攻击手段
              - 该攻击适用于在消息与密钥的长度已知的情形下，所有采取了 H(key ∥ message) 此类构造的散列函数
                - 消息填充方式都比较类似，首先在消息后面添加一个1，然后填充若干个0，直至总长度与 448 同余，最后在其后附上64位的消息长度（填充前）
                - 每一块得到的链接变量都会被作为下一次执行hash函数的初始向量IV。在最后一块的时候，才会将其对应的链接变量转换为hash值
            - 攻击条件
              - 我们已知 key 的长度，如果不知道的话，需要爆破出来
              - 我们可以控制 message 的消息
              - 我们已经知道了包含 key 的一个消息的hash值
            - 攻击原理

    - 数字签名

      - RAS签名
      - ElGamal签名
      - DSA签名